<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cyy.finance.dao.ProductMapper">
    <resultMap type="com.cyy.finance.domain.Record" id="recordMap">
        <id property="id" column="id" />
        <result property="productId" column="product_id" />
        <result property="confirm" column="confirm" />
        <result property="createDate" column="create_date" />
    </resultMap>
    <resultMap type="com.cyy.finance.model.ConfirmSumVO" id="confirmSumVOMap">
        <result property="productName" column="name" />
        <result property="sumConfirm" column="confirm" />
    </resultMap>
    <resultMap type="com.cyy.finance.model.RecordVO" id="recordVOMap">
        <id property="id" column="id" />
        <result property="productName" column="name" />
        <result property="confirm" column="confirm" />
        <result property="createDate" column="create_date" />
    </resultMap>

    <select id="getProductList" resultType="com.cyy.finance.domain.Product">
        select id, name, type from product;
    </select>

    <select id="productChangeRecord" resultMap="recordVOMap">
        select r.id, p.name, r.operation, r.confirm, r.create_date from record r, product p where r.product_id = p.id order by r.create_date desc;
    </select>

    <select id="getProductChangeRecordCount" resultType="Integer">
        select count(id) from record;
    </select>

    <insert id="addProductChangeRecord" parameterType="com.cyy.finance.domain.Record">
        insert into record values (#{id}, #{productId}, #{confirm}, #{createDate}, #{operation})
    </insert>

    <select id="productConfirmSum" resultMap="confirmSumVOMap">
        select p.name, sum(r.confirm) as confirm from record r, product p where r.product_id = p.id GROUP BY r.product_id order by confirm desc
    </select>

</mapper>