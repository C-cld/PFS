<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cyy.finance.dao.ProfitMapper">
    <resultMap type="com.cyy.finance.domain.Profit" id="profitMap">
        <id property="id" column="id" />
        <result property="productId" column="product_id" />
        <result property="profit" column="profit" />
        <result property="createDate" column="create_date" />
    </resultMap>

    <resultMap type="com.cyy.finance.model.ProfitSumPerDay" id="profitSumPerDayMap">
        <result property="sum" column="sum" />
        <result property="createDate" column="create_date" />
    </resultMap>

    <resultMap type="com.cyy.finance.model.ProfitSum" id="profitSumMap">
        <result property="productId" column="productId" />
        <result property="productName" column="productName" />
        <result property="sumProfit" column="sumProfit" />
    </resultMap>

    <select id="getProfitSumPerDayList" resultMap="profitSumPerDayMap">
        select round(sum(profit),2) as sum, create_date from profit group by create_date ORDER BY create_date asc
    </select>

    <select id="getProfitSumList" resultMap="profitSumMap">
        select p.id as productId, p.name as productName, t.sumProfit as sumProfit
        from product p LEFT JOIN (select product_id, round(sum(profit),2) as sumProfit from profit GROUP BY product_id) t
        on p.id = t.product_id
        order by sumProfit desc
    </select>

    <select id="getProfitDetailList" resultMap="profitMap">
        select profit, create_date from profit where product_id = #{productId} order by create_date desc limit #{index}, #{pageSize}
    </select>

    <select id="getCount" resultType="Integer">
        select count(id) from profit where product_id = #{productId}
    </select>

    <insert id="addProfitDetail" parameterType="com.cyy.finance.domain.Profit">
        insert into profit (id, product_id, profit, create_date)
        values (#{id}, #{productId}, #{profit}, #{createDate})
    </insert>

    <select id="getTotalProfit" resultType="Float">
        select round(sum(profit),2) from profit
    </select>

</mapper>